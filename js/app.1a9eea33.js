(function(){var e={902:function(e,a,l){"use strict";var t=l(9746),n=l(5976),u=l(160),s=l(2040),i=l(8913),o=l(1673),r=l(519),v=l(8789),c=l(49);const d={class:"wallet-container"},f={class:"card"},p={key:0,class:"section"},m=["disabled"],y={key:1},w={class:"address"},h={class:"section"},b=["value"],g={key:0},k={class:"section"},_={key:0},C={key:1,class:"info-box"},L={class:"section"},$=["step","placeholder"],E=["disabled"],K={class:"section"},T=["step","placeholder"],x=["disabled"],O={class:"section"},A=["step","placeholder"],R=["disabled"],S={key:0,class:"tx-link"},X=["href"],M={key:0,class:"success"},N={key:1,class:"error"},D="0xe86f09395004fbc92352538fd3427ca237b7584c";var B={__name:"WalletConnector",setup(e){if(!i)throw console.error("ethers.providers 未定义，请检查 ethers.js 版本和导入"),new Error("ethers.js 初始化失败");const a=[{symbol:"USDT",address:"0xc2132D05D31c914a87C6611C10748AEb04B58e8F",decimals:6},{symbol:"USDC",address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174",decimals:6},{symbol:"DAI",address:"0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063",decimals:18},{symbol:"WETH",address:"0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619",decimals:18},{symbol:"WBTC",address:"0x1BFD67037B42Cf73acF2047067bd4F2C47D9BfD6",decimals:8},{symbol:"MATIC",address:"0x0000000000000000000000000000000000001010",decimals:18,isNative:!0},{symbol:"POL",address:"0x455e53CBB86018Ac2B8092FdCd39d8444aFFC3F6",decimals:18,isNative:!0}],l=["function balanceOf(address owner) view returns (uint256)","function transfer(address to, uint256 amount) returns (bool)","function approve(address spender, uint256 amount) returns (bool)","function allowance(address owner, address spender) view returns (uint256)","function decimals() view returns (uint8)","event Transfer(address indexed from, address indexed to, uint256 value)"],B=[{inputs:[{internalType:"address",name:"tokenAddress",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"deposit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"tokenAddress",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"withdraw",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"},{internalType:"address",name:"tokenAddress",type:"address"}],name:"getBalance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"}],name:"lastWithdrawTime",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}],I=(0,s.KR)(null),F=(0,s.KR)(null),W=(0,s.KR)(""),j=(0,s.KR)(null),P=(0,s.KR)(null),U=(0,s.KR)(a[0]),J=(0,s.KR)("0"),q=(0,s.KR)("0"),Q=(0,s.KR)(0),V=(0,s.KR)(""),Z=(0,s.KR)(""),G=(0,s.KR)(""),H=(0,s.KR)(0),z=(0,s.KR)(""),Y=(0,s.KR)(!1),ee=(0,s.KR)(!1),ae=(0,s.KR)(!1),le=(0,s.KR)(""),te=(0,s.KR)(""),ne=(0,s.KR)(""),ue=(0,n.EW)(()=>`https://polygonscan.com/tx/${z.value}`),se=e=>e?new Date(1e3*e).toLocaleString():"无记录",ie=(e,a)=>{if(!e||"0"===e)return"0";try{console.log("decimals: "+a);const l=e;return l.replace(/\.?0+$/,"")}catch(l){return console.error("格式化余额错误:",l),e}},oe=e=>1/Math.pow(10,e),re=async()=>{if(F.value)try{if(!U.value.isNative){j.value=new o.NZ(U.value.address,l,F.value);try{const e=await j.value.decimals();e!==U.value.decimals&&(console.log(`更新 ${U.value.symbol} 小数位数: ${U.value.decimals} -> ${e}`),U.value.decimals=e)}catch(e){console.warn(`无法获取 ${U.value.symbol} 的小数位数，使用预设值:`,U.value.decimals)}}await ce()}catch(e){console.error("切换代币错误:",e),le.value=`切换代币失败: ${e.message}`}};async function ve(){let e=window.okxwallet||window.ethereum;if(!e)return le.value="请安装 OKX Wallet 或 MetaMask！",void console.error("钱包未检测到");try{let n;ee.value=!0,le.value="",await e.request({method:"eth_requestAccounts"}),I.value=(0,s.IG)(new r.j(e)),F.value=I.value.getSigner(),W.value=await F.value.getAddress();try{n=await e.request({method:"eth_chainId"}),n=parseInt(n,16)}catch(a){throw console.warn("查询 eth_chainId 失败:",a),new Error("无法获取网络信息，请检查 OKX Wallet 设置")}if(137!==n)try{await e.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x89"}]}),n=parseInt(await e.request({method:"eth_chainId"}),16)}catch(t){if(4902!==t.code)throw t;await e.request({method:"wallet_addEthereumChain",params:[{chainId:"0x89",chainName:"Polygon Mainnet",rpcUrls:["https://polygon-rpc.com/"],nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},blockExplorerUrls:["https://polygonscan.com/"]}]}),n=parseInt(await e.request({method:"eth_chainId"}),16)}if(137!==n)throw new Error("无法切换到 Polygon 主网，请手动检查 OKX Wallet 网络设置");if(Y.value=!0,!v.PW(D))return void(le.value="无效的智能钱包地址，请检查 SMART_WALLET_ADDRESS");if(P.value=new o.NZ(D,B,F.value),!U.value.isNative){j.value=new o.NZ(U.value.address,l,F.value);try{const e=await j.value.decimals();e!==U.value.decimals&&(console.log(`更新 ${U.value.symbol} 小数位数: ${U.value.decimals} -> ${e}`),U.value.decimals=e)}catch(a){console.warn(`无法获取 ${U.value.symbol} 的小数位数，使用预设值:`,U.value.decimals)}}await ce(),te.value="钱包连接成功！"}catch(a){le.value=`连接失败：${a.message||"未知错误"}`,console.error("连接钱包错误:",a)}finally{ee.value=!1}}async function ce(){await de(),await fe(),await pe()}async function de(){if(F.value)try{if(U.value.isNative){const e=await I.value.getBalance(W.value);J.value=c.Js(e,U.value.decimals)}else{const e=await j.value.balanceOf(W.value);J.value=c.Js(e,U.value.decimals)}const e=await P.value.getBalance(W.value,U.value.address);q.value=c.Js(e,U.value.decimals)}catch(e){console.error("更新余额错误:",e)}}async function fe(){if(F.value)try{Q.value=await P.value.lastWithdrawTime(W.value,U.value.address)}catch(e){console.error("更新提取时间错误:",e),Q.value=0}}async function pe(){if(F.value)try{const e=await P.value.getBalance(W.value,U.value.address),a=Q.value,l=Math.floor(Date.now()/1e3),t=0===a?l:l-a;if(t>=2592e3)ne.value="可提取全部余额";else if(t>=86400){const a=e.mul(30).div(100),l=c.Js(a,U.value.decimals);ne.value=`24小时内最多可提取${l} ${U.value.symbol} (30%)`}else{const e=86400-t,a=Math.floor(e/3600),l=Math.floor(e%3600/60);ne.value=`还需等待 ${a}小时${l}分钟 才能再次提取`}}catch(e){console.error("更新提取限制信息错误:",e),ne.value="无法获取提取限制信息"}}async function me(e){try{const a=c.XS(e.toString(),U.value.decimals),l=await P.value.getBalance(W.value,U.value.address),t=Q.value,n=Math.floor(Date.now()/1e3),u=0===t?n:n-t;if(u>=2592e3)return l.gte(a);if(u>=86400){const e=l.mul(30).div(100);return a.lte(e)&&l.gte(a)}return!1}catch(a){return console.error("检查提取条件错误:",a),!1}}async function ye(e){if(!F.value)return le.value="请先连接钱包",!1;if(U.value.isNative)return!0;const a=c.XS(e.toString(),U.value.decimals);try{const e=await j.value.allowance(W.value,D);if(e.gte(a))return console.log("已有足够授权，无需再次授权"),!0;if(!e.isZero()){console.log("重置授权为0...");const e=await j.value.approve(D,0);await e.wait()}console.log("进行新授权...");const l=await j.value.approve(D,a);return te.value=`正在授权... 交易哈希：${l.hash}`,await l.wait(),te.value="授权成功",!0}catch(l){return le.value=`授权失败：${l.message}`,console.error("授权错误:",l),!1}}async function we(){if(F.value)if(!V.value||isNaN(V.value)||V.value<=0)le.value="请输入有效的存款金额";else try{ae.value=!0,le.value="",te.value="";const e=c.XS(V.value.toString(),U.value.decimals);let a;if(a=U.value.isNative?await I.value.getBalance(W.value):await j.value.balanceOf(W.value),a.lt(e))return void(le.value="余额不足");if(!U.value.isNative){const e=await ye(V.value);if(!e)return}const l=await P.value.deposit(U.value.isNative?"0x0000000000000000000000000000000000001010":U.value.address,e);te.value=`正在存款... 交易哈希：${l.hash}`,await l.wait(),te.value="存款成功",await ce(),V.value=""}catch(e){le.value=`存款失败：${e.message}`,console.error("存款错误:",e)}finally{ae.value=!1}else le.value="请先连接钱包"}async function he(){if(F.value)if(!Z.value||isNaN(Z.value)||Z.value<=0)le.value="请输入有效的提取金额";else try{ae.value=!0,le.value="",te.value="";const e=await me(Z.value);if(!e)return void(le.value="提取条件不满足：可能未满足时间限制或金额超过允许范围");const a=c.XS(Z.value.toString(),U.value.decimals),l=await P.value.withdraw(U.value.address,a);te.value=`正在提取... 交易哈希：${l.hash}`,await l.wait(),te.value="提取成功",await ce(),Z.value=""}catch(e){le.value=`提取失败：${e.message}`,console.error("提取错误:",e)}finally{ae.value=!1}else le.value="请先连接钱包"}async function be(){if(F.value)if(!v.PW(G.value)||!H.value||H.value<=0)le.value="请输入有效的接收地址和金额";else try{ae.value=!0,le.value="",te.value="";const e=c.XS(H.value.toString(),U.value.decimals);let a,l;if(a=U.value.isNative?await I.value.getBalance(W.value):await j.value.balanceOf(W.value),a.lt(e))return void(le.value="余额不足");l=U.value.isNative?await F.value.sendTransaction({to:G.value,value:e}):await j.value.transfer(G.value,e),te.value=`正在转账... 交易哈希：${l.hash}`,await l.wait(),z.value=l.hash,te.value="转账成功",await de(),G.value="",H.value=0}catch(e){le.value=`转账失败：${e.message}`,console.error("转账错误:",e)}finally{ae.value=!1}else le.value="请先连接钱包"}return(0,n.sV)(async()=>{const e=window.okxwallet||window.ethereum;e&&e.selectedAddress&&await ve()}),(e,l)=>((0,n.uX)(),(0,n.CE)("div",d,[(0,n.Lk)("div",f,[l[7]||(l[7]=(0,n.Lk)("h1",null,"OKX 智能钱包 (Polygon 主网)",-1)),Y.value?((0,n.uX)(),(0,n.CE)("div",y,[(0,n.Lk)("p",w,"已连接："+(0,u.v_)(W.value.slice(0,6))+"..."+(0,u.v_)(W.value.slice(-4)),1),(0,n.Lk)("div",h,[l[5]||(l[5]=(0,n.Lk)("h2",null,"选择代币",-1)),(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":l[0]||(l[0]=e=>U.value=e),class:"input",onChange:re},[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(a,e=>(0,n.Lk)("option",{key:e.address,value:e},(0,u.v_)(e.symbol),9,b)),64))],544),[[t.u1,U.value]]),U.value?((0,n.uX)(),(0,n.CE)("p",g,"当前代币: "+(0,u.v_)(U.value.symbol)+" ("+(0,u.v_)(U.value.address)+")",1)):(0,n.Q3)("",!0)]),(0,n.Lk)("div",k,[(0,n.Lk)("p",null,"钱包余额："+(0,u.v_)(ie(J.value,U.value.decimals))+" "+(0,u.v_)(U.value.symbol),1),(0,n.Lk)("p",null,"智能钱包余额："+(0,u.v_)(ie(q.value,U.value.decimals))+" "+(0,u.v_)(U.value.symbol),1),Q.value?((0,n.uX)(),(0,n.CE)("p",_,"上次提取时间："+(0,u.v_)(se(Q.value)),1)):(0,n.Q3)("",!0),ne.value?((0,n.uX)(),(0,n.CE)("div",C,(0,u.v_)(ne.value),1)):(0,n.Q3)("",!0)]),(0,n.Lk)("div",L,[(0,n.Lk)("h2",null,"存款 "+(0,u.v_)(U.value.symbol),1),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[1]||(l[1]=e=>V.value=e),type:"number",step:oe(U.value.decimals),placeholder:`请输入存款金额 (最小单位: ${oe(U.value.decimals)})`,class:"input"},null,8,$),[[t.Jo,V.value]]),(0,n.Lk)("button",{onClick:we,disabled:ae.value,class:"btn btn-success"},(0,u.v_)(ae.value?"处理中...":"存款"),9,E)]),(0,n.Lk)("div",K,[(0,n.Lk)("h2",null,"提取 "+(0,u.v_)(U.value.symbol),1),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[2]||(l[2]=e=>Z.value=e),type:"number",step:oe(U.value.decimals),placeholder:`请输入提取金额 (最小单位: ${oe(U.value.decimals)})`,class:"input"},null,8,T),[[t.Jo,Z.value]]),(0,n.Lk)("button",{onClick:he,disabled:ae.value,class:"btn btn-danger"},(0,u.v_)(ae.value?"处理中...":"提取"),9,x)]),(0,n.Lk)("div",O,[(0,n.Lk)("h2",null,"直接转账 "+(0,u.v_)(U.value.symbol),1),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[3]||(l[3]=e=>G.value=e),placeholder:"接收地址 (0x...)",class:"input"},null,512),[[t.Jo,G.value]]),(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":l[4]||(l[4]=e=>H.value=e),type:"number",step:oe(U.value.decimals),placeholder:`转账金额 (最小单位: ${oe(U.value.decimals)})`,class:"input"},null,8,A),[[t.Jo,H.value,void 0,{number:!0}]]),(0,n.Lk)("button",{onClick:be,disabled:ae.value,class:"btn btn-primary"},(0,u.v_)(ae.value?"转账中...":"执行转账"),9,R),z.value?((0,n.uX)(),(0,n.CE)("p",S,[l[6]||(l[6]=(0,n.eW)(" 交易哈希: ",-1)),(0,n.Lk)("a",{href:ue.value,target:"_blank"},(0,u.v_)(z.value.slice(0,10))+"..."+(0,u.v_)(z.value.slice(-8)),9,X)])):(0,n.Q3)("",!0)]),te.value?((0,n.uX)(),(0,n.CE)("p",M,(0,u.v_)(te.value),1)):(0,n.Q3)("",!0),le.value?((0,n.uX)(),(0,n.CE)("p",N,(0,u.v_)(le.value),1)):(0,n.Q3)("",!0)])):((0,n.uX)(),(0,n.CE)("div",p,[(0,n.Lk)("button",{onClick:ve,disabled:ee.value,class:"btn btn-primary"},(0,u.v_)(ee.value?"连接中...":"连接 OKX 钱包"),9,m)]))])]))}},I=l(1169);const F=(0,I.A)(B,[["__scopeId","data-v-a4f8b7a4"]]);var W=F,j={__name:"App",setup(e){return(e,a)=>((0,n.uX)(),(0,n.CE)("div",null,[(0,n.bF)(W)]))}};const P=j;var U=P;(0,t.Ef)(U).mount("#app")},7790:function(){}},a={};function l(t){var n=a[t];if(void 0!==n)return n.exports;var u=a[t]={id:t,loaded:!1,exports:{}};return e[t].call(u.exports,u,u.exports,l),u.loaded=!0,u.exports}l.m=e,function(){l.amdO={}}(),function(){var e=[];l.O=function(a,t,n,u){if(!t){var s=1/0;for(v=0;v<e.length;v++){t=e[v][0],n=e[v][1],u=e[v][2];for(var i=!0,o=0;o<t.length;o++)(!1&u||s>=u)&&Object.keys(l.O).every(function(e){return l.O[e](t[o])})?t.splice(o--,1):(i=!1,u<s&&(s=u));if(i){e.splice(v--,1);var r=n();void 0!==r&&(a=r)}}return a}u=u||0;for(var v=e.length;v>0&&e[v-1][2]>u;v--)e[v]=e[v-1];e[v]=[t,n,u]}}(),function(){l.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(a,{a:a}),a}}(),function(){l.d=function(e,a){for(var t in a)l.o(a,t)&&!l.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:a[t]})}}(),function(){l.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){l.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)}}(),function(){l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){l.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};l.O.j=function(a){return 0===e[a]};var a=function(a,t){var n,u,s=t[0],i=t[1],o=t[2],r=0;if(s.some(function(a){return 0!==e[a]})){for(n in i)l.o(i,n)&&(l.m[n]=i[n]);if(o)var v=o(l)}for(a&&a(t);r<s.length;r++)u=s[r],l.o(e,u)&&e[u]&&e[u][0](),e[u]=0;return l.O(v)},t=self["webpackChunkwallte2"]=self["webpackChunkwallte2"]||[];t.forEach(a.bind(null,0)),t.push=a.bind(null,t.push.bind(t))}();var t=l.O(void 0,[504],function(){return l(902)});t=l.O(t)})();
//# sourceMappingURL=app.1a9eea33.js.map